---
const { count = 40 } = Astro.props;
---

<div class="leaves-container" aria-hidden="true">
  {
    Array.from({ length: count }).map(() => (
      <div class="leaf">
        <img src="/leaf.svg" alt="" />
      </div>
    ))
  }
</div>

<style>
  .leaves-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    overflow: hidden;
  }

  .leaf {
    position: absolute;
    top: -100px;
    animation: fall linear infinite;
  }

  .leaf img {
    width: 100%;
    height: 100%;
    animation: sway 2s ease-in-out infinite alternate;
  }

  .leaf img.flipped {
    transform: scaleX(-1);
  }

  @keyframes fall {
    0% {
      transform: translateY(0) rotate(0deg);
    }
    100% {
      transform: translateY(100vh) rotate(var(--rotation));
    }
  }

  @keyframes sway {
    from {
      transform: translateX(-20px) rotate(-15deg);
    }
    to {
      transform: translateX(20px) rotate(15deg);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const leaves = document.querySelectorAll('.leaf');
    const container = document.querySelector('.leaves-container') as HTMLElement;

    if (!container) return;

    const setLeafStyles = () => {
      const viewportWidth = container.offsetWidth;
      const centerStart = viewportWidth * 0.2;
      const centerEnd = viewportWidth * 0.8;

      leaves.forEach((leaf) => {
        const htmlLeaf = leaf as HTMLElement;
        const size = Math.random() * 20 + 20;
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * -20;

        let leftPosition;
        const randomChoice = Math.random();

        if (randomChoice < 0.2) {
          leftPosition = centerStart + Math.random() * (centerEnd - centerStart);
        } else if (randomChoice < 0.6) {
          leftPosition = Math.random() * centerStart;
        } else {
          leftPosition = centerEnd + Math.random() * (viewportWidth - centerEnd);
        }

        htmlLeaf.style.left = `${leftPosition}px`;
        htmlLeaf.style.width = `${size}px`;
        htmlLeaf.style.height = `${size}px`;
        htmlLeaf.style.animationDuration = `${duration}s`;
        htmlLeaf.style.animationDelay = `${delay}s`;

        const initialRotation = Math.random() * 60 - 30;
        htmlLeaf.style.transform = `rotate(${initialRotation}deg)`;

        const rotationSpeed = Math.random() * 360;
        htmlLeaf.style.setProperty('--rotation', `${rotationSpeed}deg`);

        const img = htmlLeaf.querySelector('img');
        if (img) {
          img.style.filter = `brightness(${Math.random() * 0.7 + 0.7})`;
          let transformStyle = '';
          if (Math.random() > 0.5) {
            transformStyle += 'scaleX(-1)';
          }
          img.style.transform = transformStyle;
        }
      });
    };

    setLeafStyles();
    window.addEventListener('resize', setLeafStyles);
  });
</script>
